

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Auto-saving: simple save/restore of PVs &#8212; Epics Channel Access for Python</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/epicsdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="wx: wxPython Widgets for Epics" href="wx.html" />
    <link rel="prev" title="Alarms: respond when a PV goes out of range" href="alarm.html" /> 
  </head><body>
<div style="background-color: #E7F0F3; text-align: left; padding: 8px 4px 8px 4px">
  <font size=+3><a href="index.html">
      <img src="_static/pyepics.png" height=50 border="0" alt="pyepics"/>
    &nbsp; PyEpics: Epics Channel Access for Python</a>
  </font>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="wx.html" title="wx: wxPython Widgets for Epics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="alarm.html" title="Alarms: respond when a PV goes out of range"
             accesskey="P">previous</a> |</li>
   <li>[<a href="installation.html">install</a></li>
   <li>|<a href="overview.html">overview</a></li>
   <li>|<a href="pv.html">pv</a></li>
   <li>|<a href="ca.html">ca</a></li>
   <li>|<a href="arrays.html">arrays</a></li>
   <li>|<a href="devices.html">devices</a></li>
   <li>|<a href="alarm.html">alarm</a></li>
   <li>|<a href="#">autosave</a></li>
   <li>|<a href="wx.html">wx</a></li>
   <li>|<a href="advanced.html">advanced</a>]</li>

        <li class="nav-item nav-item-this"><a href="">Auto-saving: simple save/restore of PVs</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Auto-saving: simple save/restore of PVs</a><ul>
<li><a class="reference internal" href="#autosaver-class"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoSaver</span></code> class</a></li>
<li><a class="reference internal" href="#supported-data-types">Supported Data Types</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="alarm.html"
                        title="previous chapter">Alarms: respond when a PV goes out of range</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="wx.html"
                        title="next chapter">wx: wxPython Widgets for Epics</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/autosave.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-autosave">
<span id="auto-saving-simple-save-restore-of-pvs"></span><h1>Auto-saving: simple save/restore of PVs<a class="headerlink" href="#module-autosave" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#module-autosave" title="autosave: simple save/restore of PVs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autosave</span></code></a> module provides simple save/restore functionality for
PVs, with the functions <a class="reference internal" href="#autosave.save_pvs" title="autosave.save_pvs"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_pvs()</span></code></a> and <a class="reference internal" href="#autosave.restore_pvs" title="autosave.restore_pvs"><code class="xref py py-func docutils literal notranslate"><span class="pre">restore_pvs()</span></code></a>, and an
<a class="reference internal" href="#autosave.AutoSaver" title="autosave.AutoSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoSaver</span></code></a> class.  These are similar to the autosave module from
synApps for IOCs in that they use a compatible <em>request file</em> which
describes the PVs to save, and a compatible <em>save file</em> which holds the
saved values. Of course, the reading and writing is done here via Channel
Access, and need not be related to an single IOC.</p>
<p>Use of this module requires the <a class="reference external" href="http://pyparsing.wikispaces.com/">pyparsing package</a> to be installed.  This is a fairly
common third-party python package, included in many package managers, or
installed with tools such as <em>easy_install</em> or <em>pip</em>, or downloaded from
<a class="reference external" href="http://pypi.python.org/pypi/pyparsing">PyPI</a></p>
<p>Request and Save file formats are designed to be compatible with synApps
autosave.  Notably, the <cite>file</cite> command with macro substitutions are
supported, so that one can have a Request like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># My.req</span>
<span class="n">file</span> <span class="s2">&quot;SimpleMotor.req&quot;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">IOC</span><span class="p">:,</span> <span class="n">Q</span><span class="o">=</span><span class="n">m1</span>
</pre></div>
</div>
<p>with a  <strong>SimpleMotor.req</strong> file of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># SimpleMotor.req
$(P)$(Q).VAL
$(P)$(Q).DIR
$(P)$(Q).FOFF
</pre></div>
</div>
<p>which can then be used for many instances of a SimpleMotor.  There is,
however, no automated mechanism for finding request files.  You will need
to include these in the working directory or specify absolute paths.</p>
<p>With such a file, simply using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epics.autosave</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">save_pvs</span><span class="p">(</span><span class="s2">&quot;My.req&quot;</span><span class="p">,</span> <span class="s2">&quot;my_values.sav&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will save the current values for the PVs to the file <strong>my_values.sav</strong>.  At
a later time, these values can be restored with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epics.autosave</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">restore_pvs</span><span class="p">(</span><span class="s2">&quot;my_values.sav&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The saved file will be of nearly identical format as that of the autosave
mechanism, and the <a class="reference internal" href="#autosave.restore_pvs" title="autosave.restore_pvs"><code class="xref py py-func docutils literal notranslate"><span class="pre">restore_pvs()</span></code></a> function can read and restore values
using save files from autosave.  Note, however, that the purpose here is
quite different from that of the standard autosave module (which is
designed to save vales so that PVs can be <strong>initialized</strong> at IOC startup).
Using the functions here will really do a <code class="xref py py-func docutils literal notranslate"><span class="pre">caput()</span></code> to the saved
values.</p>
<dl class="py function">
<dt class="sig sig-object py" id="autosave.save_pvs">
<span class="sig-prename descclassname"><span class="pre">autosave.</span></span><span class="sig-name descname"><span class="pre">save_pvs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.save_pvs" title="Permalink to this definition">¶</a></dt>
<dd><p>saves current value of PVs listed in <em>request_file</em> to the <em>save_file</em></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request_file</strong> – name of Request file to read PVs to save.</p></li>
<li><p><strong>save_file</strong> – name of file to save values to write values to</p></li>
</ul>
</dd>
</dl>
<p>As discussed above, the <strong>request_file</strong> follows the conventions of the
autosave module from synApps.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="autosave.restore_pvs">
<span class="sig-prename descclassname"><span class="pre">autosave.</span></span><span class="sig-name descname"><span class="pre">restore_pvs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.restore_pvs" title="Permalink to this definition">¶</a></dt>
<dd><p>reads values from <em>save_file</em> and restores them for the corresponding PVs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>save_file</strong> – name of file to save values to read data from.</p>
</dd>
</dl>
<p>Note that <a class="reference internal" href="#autosave.restore_pvs" title="autosave.restore_pvs"><code class="xref py py-func docutils literal notranslate"><span class="pre">restore_pvs()</span></code></a> will restore all the values it can, skipping
over any values that it cannot restore.</p>
</dd></dl>

<section id="autosaver-class">
<h2><a class="reference internal" href="#autosave.AutoSaver" title="autosave.AutoSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoSaver</span></code></a> class<a class="headerlink" href="#autosaver-class" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#autosave.AutoSaver" title="autosave.AutoSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoSaver</span></code></a> class provides a convenient way to repeatedly save
PVs listed in a request file without having to re-connect all of the PVs.
The <a class="reference internal" href="#autosave.AutoSaver" title="autosave.AutoSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoSaver</span></code></a> retains the PV connections, and provides a simple
<a class="reference internal" href="#autosave.save" title="autosave.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> method to save the current PV values to a file.  By default,
that file will be named from the request file and the current time.  This
allows you to do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># save PVs from a request file once per minute</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">epics.autosave</span> <span class="kn">import</span> <span class="n">AutoSaver</span>
<span class="n">my_saver</span> <span class="o">=</span> <span class="n">AutoSaver</span><span class="p">(</span><span class="s2">&quot;My.req&quot;</span><span class="p">)</span>

<span class="c1"># save all PVs every minute for a day</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span><span class="o">.</span><span class="n">tm_sec</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">my_saver</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span><span class="o">.</span><span class="n">tm_sec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span> <span class="o">&gt;</span> <span class="mf">86400.0</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>This will save PVs to files with names like <em>My_2017Oct02_141800.sav</em></p>
<dl class="py class">
<dt class="sig sig-object py" id="autosave.AutoSaver">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">autosave.</span></span><span class="sig-name descname"><span class="pre">AutoSaver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.AutoSaver" title="Permalink to this definition">¶</a></dt>
<dd><p>create an Automatic Saver based on a request file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request_file</strong> – name of request file</p>
</dd>
</dl>
</dd></dl>

<p><a class="reference internal" href="#autosave.AutoSaver" title="autosave.AutoSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoSaver</span></code></a> has two methods: <a class="reference internal" href="#autosave.read_request_file" title="autosave.read_request_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read_request_file()</span></code></a> to read a
request file,  and <a class="reference internal" href="#autosave.save" title="autosave.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> to save the results.</p>
<dl class="py method">
<dt class="sig sig-object py" id="autosave.read_request_file">
<span class="sig-prename descclassname"><span class="pre">autosave.</span></span><span class="sig-name descname"><span class="pre">read_request_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">request_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.read_request_file" title="Permalink to this definition">¶</a></dt>
<dd><p>read and parse request file, begin making PV connections</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request_file</strong> – name of request file</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autosave.save">
<span class="sig-prename descclassname"><span class="pre">autosave.</span></span><span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.save" title="Permalink to this definition">¶</a></dt>
<dd><p>read current PV values, write save file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>save_file</strong> – name of save file or <cite>None</cite>.  If <cite>None</cite>, the name of
the request file and timestamp (to seconds) will be
used to build a file name.  Note that there is no
check for overwriting files.</p></li>
<li><p><strong>verbose</strong> – whether to print results to the screen [default <cite>False</cite>]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="supported-data-types">
<h2>Supported Data Types<a class="headerlink" href="#supported-data-types" title="Permalink to this headline">¶</a></h2>
<p>All scalar PV values can be saved and restored with the <a class="reference internal" href="#module-autosave" title="autosave: simple save/restore of PVs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autosave</span></code></a>
routines.  There is some support for waveform (array) data.  For example,
character waveforms containing for long strings can be saved and restored.
In addition, numerical arrays in waveform can be saved and restored.  For
array data, the results may not be fully compatible with the autosave
module.</p>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>A simple example using the autosave module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epics.autosave</span>
<span class="c1"># save values</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">save_pvs</span><span class="p">(</span><span class="s2">&quot;my_request_file.req&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/tmp/my_recent_save.sav&quot;</span><span class="p">)</span>

<span class="c1"># wait 30 seconds</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># restore those values back</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">restore_pvs</span><span class="p">(</span><span class="s2">&quot;/tmp/my_recent_save.sav&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="wx.html" title="wx: wxPython Widgets for Epics"
             >next</a> |</li>
        <li class="right" >
          <a href="alarm.html" title="Alarms: respond when a PV goes out of range"
             >previous</a> |</li>
   <li>[<a href="installation.html">install</a></li>
   <li>|<a href="overview.html">overview</a></li>
   <li>|<a href="pv.html">pv</a></li>
   <li>|<a href="ca.html">ca</a></li>
   <li>|<a href="arrays.html">arrays</a></li>
   <li>|<a href="devices.html">devices</a></li>
   <li>|<a href="alarm.html">alarm</a></li>
   <li>|<a href="#">autosave</a></li>
   <li>|<a href="wx.html">wx</a></li>
   <li>|<a href="advanced.html">advanced</a>]</li>

        <li class="nav-item nav-item-this"><a href="">Auto-saving: simple save/restore of PVs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Matthew Newville.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>